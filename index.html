<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UK Theory Test - Classroom Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Poppins:wght@700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --secondary: #10b981;
            --accent: #f59e0b;
            --danger: #ef4444;
            --dark: #1e293b;
            --light: #f8fafc;
            --border: #e2e8f0;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--dark);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Login Screen */
        .login-screen {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-card {
            background: white;
            padding: 50px;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 450px;
            width: 100%;
            animation: slideUp 0.6s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .login-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .login-logo {
            font-size: 64px;
            margin-bottom: 16px;
        }

        .login-title {
            font-family: 'Poppins', sans-serif;
            font-size: 28px;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 8px;
        }

        .login-subtitle {
            color: #64748b;
            font-size: 15px;
        }

        .role-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 24px;
        }

        .role-btn {
            padding: 16px;
            border: 3px solid var(--border);
            background: white;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 15px;
            font-family: 'Inter', sans-serif;
        }

        .role-btn:hover {
            border-color: var(--primary);
            background: rgba(37, 99, 235, 0.05);
        }

        .role-btn.active {
            border-color: var(--primary);
            background: var(--primary);
            color: white;
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--dark);
            font-size: 14px;
        }

        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 15px;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .btn {
            padding: 16px 32px;
            border: none;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
            font-family: 'Inter', sans-serif;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            width: 100%;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(37, 99, 235, 0.4);
        }

        .alert {
            padding: 12px 16px;
            border-radius: 12px;
            margin-bottom: 20px;
            font-size: 14px;
            font-weight: 500;
        }

        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #ef4444;
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #10b981;
        }

        .alert-info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #2563eb;
        }

        /* Dashboard Common */
        .dashboard {
            display: none;
        }

        .dashboard.active {
            display: block;
        }

        .navbar {
            background: white;
            padding: 20px 40px;
            border-radius: 20px;
            margin-bottom: 24px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-family: 'Poppins', sans-serif;
            font-size: 24px;
            font-weight: 800;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 18px;
        }

        .user-name {
            font-weight: 600;
        }

        .user-role {
            font-size: 13px;
            color: #64748b;
        }

        .btn-outline {
            background: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
            padding: 10px 24px;
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }

        /* Teacher Dashboard */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: white;
            padding: 28px;
            border-radius: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .stat-icon {
            font-size: 40px;
            margin-bottom: 12px;
        }

        .stat-value {
            font-size: 42px;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 14px;
            color: #64748b;
            font-weight: 600;
            text-transform: uppercase;
        }

        .card {
            background: white;
            padding: 32px;
            border-radius: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin-bottom: 24px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .card-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--dark);
        }

        .btn-secondary {
            background: white;
            color: var(--primary);
            border: 2px solid var(--primary);
            padding: 12px 24px;
        }

        .btn-secondary:hover {
            background: var(--primary);
            color: white;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table thead {
            background: var(--light);
        }

        .table th {
            padding: 14px 16px;
            text-align: left;
            font-weight: 600;
            font-size: 13px;
            text-transform: uppercase;
            color: #64748b;
        }

        .table td {
            padding: 16px;
            border-bottom: 1px solid var(--border);
        }

        .table tr:hover {
            background: rgba(37, 99, 235, 0.02);
        }

        .badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-success {
            background: #d1fae5;
            color: #065f46;
        }

        .badge-warning {
            background: #fef3c7;
            color: #92400e;
        }

        .badge-danger {
            background: #fee2e2;
            color: #991b1b;
        }

        .progress-bar-container {
            background: #e5e7eb;
            height: 8px;
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-bar {
            background: linear-gradient(90deg, var(--secondary), var(--primary));
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        /* Student Dashboard */
        .modules-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .module-card {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
            cursor: pointer;
        }

        .module-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.15);
        }

        .module-header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 24px;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .module-icon {
            font-size: 48px;
        }

        .module-info {
            flex: 1;
        }

        .module-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 6px;
        }

        .module-desc {
            font-size: 13px;
            opacity: 0.9;
        }

        .module-body {
            padding: 24px;
        }

        .module-stats {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            color: #64748b;
            margin-bottom: 16px;
        }

        .btn-block {
            width: 100%;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 24px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlide 0.3s ease-out;
        }

        @keyframes modalSlide {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            font-size: 26px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 24px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        textarea.form-input {
            min-height: 120px;
            resize: vertical;
        }

        .action-buttons {
            display: flex;
            gap: 12px;
        }

        .btn-icon {
            padding: 8px 16px;
            font-size: 14px;
            border-radius: 8px;
        }

        .btn-success {
            background: var(--secondary);
            color: white;
            border: none;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
            border: none;
        }

        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                gap: 16px;
            }
            .form-row {
                grid-template-columns: 1fr;
            }
            .table {
                font-size: 14px;
            }
            .card {
                padding: 20px;
            }
        }

        .hidden {
            display: none;
        }

        .login-info {
            margin-top: 20px;
            padding: 16px;
            background: #dbeafe;
            border-radius: 12px;
            font-size: 14px;
            line-height: 1.6;
        }

        .login-info strong {
            color: var(--primary);
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-screen">
        <div class="login-card">
            <div class="login-header">
                <div class="login-logo">üöó</div>
                <h1 class="login-title">UK Theory Test</h1>
                <p class="login-subtitle">Classroom Edition</p>
            </div>

            <div id="loginAlert"></div>

            <div class="role-selector">
                <button class="role-btn active" id="studentRoleBtn" onclick="selectRole('student')">
                    üë®‚Äçüéì Student
                </button>
                <button class="role-btn" id="teacherRoleBtn" onclick="selectRole('teacher')">
                    üë®‚Äçüè´ Teacher
                </button>
            </div>

            <form onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label class="form-label">Username</label>
                    <input type="text" class="form-input" id="username" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" id="password" required>
                </div>
                <button type="submit" class="btn btn-primary">Login</button>
            </form>

            <div class="login-info">
                <strong>üìò Default Login Credentials:</strong><br><br>
                <strong>Teacher:</strong><br>
                Username: <code>teacher</code><br>
                Password: <code>admin123</code><br><br>
                <strong>Student:</strong><br>
                Username: <code>student1</code><br>
                Password: <code>pass123</code>
            </div>
        </div>
    </div>

    <!-- Teacher Dashboard -->
    <div id="teacherDashboard" class="dashboard">
        <div class="container">
            <nav class="navbar">
                <div class="logo">üöó UK Theory Test - Teacher Panel</div>
                <div class="user-info">
                    <div>
                        <div class="user-name" id="teacherName">Teacher</div>
                        <div class="user-role">Administrator</div>
                    </div>
                    <div class="avatar" id="teacherAvatar">T</div>
                    <button class="btn btn-outline" onclick="logout()">Logout</button>
                </div>
            </nav>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üë•</div>
                    <div class="stat-value" id="totalStudents">0</div>
                    <div class="stat-label">Total Students</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚úÖ</div>
                    <div class="stat-value" id="activeStudents">0</div>
                    <div class="stat-label">Active Today</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üìä</div>
                    <div class="stat-value" id="avgProgress">0%</div>
                    <div class="stat-label">Avg Progress</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üèÜ</div>
                    <div class="stat-value" id="passedStudents">0</div>
                    <div class="stat-label">Completed</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Student Management</h2>
                    <button class="btn btn-secondary" onclick="showAddStudent()">+ Add Student</button>
                </div>
                <div style="overflow-x: auto;">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Username</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Progress</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="studentsTable"></tbody>
                    </table>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Module Performance</h2>
                </div>
                <div id="modulePerformance"></div>
            </div>
        </div>
    </div>

    <!-- Student Dashboard -->
    <div id="studentDashboard" class="dashboard">
        <div class="container">
            <nav class="navbar">
                <div class="logo">üöó UK Theory Test</div>
                <div class="user-info">
                    <div>
                        <div class="user-name" id="studentName">Student</div>
                        <div class="user-role">Learner</div>
                    </div>
                    <div class="avatar" id="studentAvatar">S</div>
                    <button class="btn btn-outline" onclick="logout()">Logout</button>
                </div>
            </nav>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üìà</div>
                    <div class="stat-value" id="studentProgress">0%</div>
                    <div class="stat-label">Overall Progress</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚úÖ</div>
                    <div class="stat-value" id="questionsCompleted">0</div>
                    <div class="stat-label">Questions Done</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üéØ</div>
                    <div class="stat-value" id="studentScore">0%</div>
                    <div class="stat-label">Average Score</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üìö</div>
                    <div class="stat-value" id="modulesCompleted">0/10</div>
                    <div class="stat-label">Modules Complete</div>
                </div>
            </div>

            <h2 style="color: white; font-size: 28px; font-weight: 700; margin-bottom: 24px;">Learning Modules</h2>

            <div class="modules-grid" id="studentModules"></div>
        </div>
    </div>

    <!-- Add Student Modal -->
    <div id="addStudentModal" class="modal">
        <div class="modal-content">
            <h2 class="modal-header">Add New Student</h2>
            <div id="addStudentAlert"></div>
            <form onsubmit="handleAddStudent(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">First Name *</label>
                        <input type="text" class="form-input" id="studentFirstName" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Last Name *</label>
                        <input type="text" class="form-input" id="studentLastName" required>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Username * (for login)</label>
                    <input type="text" class="form-input" id="studentUsername" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Password *</label>
                    <input type="password" class="form-input" id="studentPassword" required minlength="6">
                </div>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="studentEmail">
                </div>
                <div class="form-group">
                    <label class="form-label">Phone (WhatsApp)</label>
                    <input type="tel" class="form-input" id="studentPhone" placeholder="+91 9876543210">
                </div>
                <div class="form-group">
                    <label class="form-label">Notes</label>
                    <textarea class="form-input" id="studentNotes" placeholder="Batch, course details, etc."></textarea>
                </div>
                <div class="action-buttons">
                    <button type="button" class="btn btn-outline" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary" style="flex: 1;">Add Student</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Data Storage
        let currentUser = null;
        let currentRole = 'student';
        
        const modules = [
            { id: 1, title: "Alertness & Observation", desc: "Mirror checks, blind spots, awareness", questions: 50, icon: "üëÄ" },
            { id: 2, title: "Road Signs & Markings", desc: "Warning, regulatory, information signs", questions: 75, icon: "üö∏" },
            { id: 3, title: "Traffic Rules", desc: "Speed limits, parking, regulations", questions: 60, icon: "‚öñÔ∏è" },
            { id: 4, title: "Hazard Perception", desc: "Identifying and responding to hazards", questions: 45, icon: "‚ö†Ô∏è" },
            { id: 5, title: "Vehicle Safety", desc: "Maintenance, checks, breakdowns", questions: 55, icon: "üîß" },
            { id: 6, title: "Weather Conditions", desc: "Rain, fog, ice, snow driving", questions: 40, icon: "üåßÔ∏è" },
            { id: 7, title: "Vulnerable Road Users", desc: "Pedestrians, cyclists, motorcyclists", questions: 50, icon: "üö∂" },
            { id: 8, title: "Motorway Driving", desc: "Lane discipline, speed, safety", questions: 45, icon: "üõ£Ô∏è" },
            { id: 9, title: "Junctions & Roundabouts", desc: "Right of way, safe positioning", questions: 50, icon: "üîÑ" },
            { id: 10, title: "Mock Tests", desc: "Full 50-question practice tests", questions: 100, icon: "üìù" }
        ];

        // Initialize
        function init() {
            createDefaultAccounts();
            loadFromStorage();
        }

        // Create default accounts
        function createDefaultAccounts() {
            const teachers = getTeachers();
            if (teachers.length === 0) {
                const defaultTeacher = {
                    username: 'teacher',
                    password: 'admin123',
                    name: 'Demo Teacher',
                    email: 'teacher@school.com'
                };
                teachers.push(defaultTeacher);
                saveTeachers(teachers);
            }

            const students = getStudents();
            if (students.length === 0) {
                const defaultStudents = [
                    { 
                        username: 'student1', 
                        password: 'pass123',
                        firstName: 'Rahul',
                        lastName: 'Sharma',
                        email: 'rahul@example.com',
                        phone: '+91 9876543210',
                        progress: { 1: 60, 2: 40, 3: 20 },
                        notes: 'Batch A - Morning'
                    },
                    { 
                        username: 'student2', 
                        password: 'pass123',
                        firstName: 'Priya',
                        lastName: 'Patel',
                        email: 'priya@example.com',
                        phone: '+91 9876543211',
                        progress: { 1: 80, 2: 60 },
                        notes: 'Batch A - Morning'
                    },
                    { 
                        username: 'student3', 
                        password: 'pass123',
                        firstName: 'Amit',
                        lastName: 'Kumar',
                        email: 'amit@example.com',
                        phone: '+91 9876543212',
                        progress: { 1: 100, 2: 100, 3: 80 },
                        notes: 'Batch B - Evening'
                    }
                ];
                saveStudents(defaultStudents);
            }
        }

        // Storage functions
        function getTeachers() {
            return JSON.parse(localStorage.getItem('ukTheoryTeachers') || '[]');
        }

        function saveTeachers(teachers) {
            localStorage.setItem('ukTheoryTeachers', JSON.stringify(teachers));
        }

        function getStudents() {
            return JSON.parse(localStorage.getItem('ukTheoryStudents') || '[]');
        }

        function saveStudents(students) {
            localStorage.setItem('ukTheoryStudents', JSON.stringify(students));
        }

        function loadFromStorage() {
            const stored = localStorage.getItem('ukTheoryCurrentUser');
            if (stored) {
                const data = JSON.parse(stored);
                currentUser = data.user;
                currentRole = data.role;
                showDashboard(currentRole);
            }
        }

        function saveToStorage() {
            localStorage.setItem('ukTheoryCurrentUser', JSON.stringify({
                user: currentUser,
                role: currentRole
            }));
        }

        function clearStorage() {
            localStorage.removeItem('ukTheoryCurrentUser');
        }

        // Role selection
        function selectRole(role) {
            currentRole = role;
            document.querySelectorAll('.role-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(role + 'RoleBtn').classList.add('active');
        }

        // Login
        function handleLogin(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            if (currentRole === 'teacher') {
                const teachers = getTeachers();
                const teacher = teachers.find(t => t.username === username && t.password === password);
                if (teacher) {
                    currentUser = teacher;
                    saveToStorage();
                    showDashboard('teacher');
                } else {
                    showAlert('loginAlert', 'Invalid teacher credentials', 'error');
                }
            } else {
                const students = getStudents();
                const student = students.find(s => s.username === username && s.password === password);
                if (student) {
                    currentUser = student;
                    saveToStorage();
                    showDashboard('student');
                } else {
                    showAlert('loginAlert', 'Invalid student credentials', 'error');
                }
            }
        }

        // Show dashboard
        function showDashboard(role) {
            document.getElementById('loginScreen').style.display = 'none';
            if (role === 'teacher') {
                document.getElementById('teacherDashboard').classList.add('active');
                loadTeacherDashboard();
            } else {
                document.getElementById('studentDashboard').classList.add('active');
                loadStudentDashboard();
            }
        }

        // Teacher Dashboard
        function loadTeacherDashboard() {
            document.getElementById('teacherName').textContent = currentUser.name;
            document.getElementById('teacherAvatar').textContent = currentUser.name.charAt(0);
            
            const students = getStudents();
            
            // Update stats
            document.getElementById('totalStudents').textContent = students.length;
            document.getElementById('activeStudents').textContent = Math.floor(students.length * 0.7);
            
            let totalProgress = 0;
            let completed = 0;
            students.forEach(s => {
                const progress = s.progress || {};
                const avg = Object.values(progress).reduce((a, b) => a + b, 0) / 10;
                totalProgress += avg;
                if (avg >= 100) completed++;
            });
            document.getElementById('avgProgress').textContent = Math.round(totalProgress / students.length) + '%';
            document.getElementById('passedStudents').textContent = completed;
            
            // Load students table
            loadStudentsTable();
            loadModulePerformance();
        }

        function loadStudentsTable() {
            const students = getStudents();
            const tbody = document.getElementById('studentsTable');
            tbody.innerHTML = '';
            
            students.forEach((student, index) => {
                const progress = student.progress || {};
                const avgProgress = Object.values(progress).reduce((a, b) => a + b, 0) / 10;
                const status = avgProgress >= 80 ? 'success' : avgProgress >= 40 ? 'warning' : 'danger';
                const statusText = avgProgress >= 80 ? 'Excellent' : avgProgress >= 40 ? 'In Progress' : 'Started';
                
                const row = `
                    <tr>
                        <td><strong>${student.firstName} ${student.lastName}</strong></td>
                        <td>${student.username}</td>
                        <td>${student.email || '-'}</td>
                        <td>${student.phone || '-'}</td>
                        <td>
                            <div style="width: 150px;">
                                <div class="progress-bar-container">
                                    <div class="progress-bar" style="width: ${avgProgress}%"></div>
                                </div>
                                <small style="color: #64748b; font-size: 12px;">${Math.round(avgProgress)}%</small>
                            </div>
                        </td>
                        <td><span class="badge badge-${status}">${statusText}</span></td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-icon btn-success" onclick="viewStudent(${index})" title="View Details">üëÅÔ∏è</button>
                                <button class="btn btn-icon btn-danger" onclick="deleteStudent(${index})" title="Delete">üóëÔ∏è</button>
                            </div>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        function loadModulePerformance() {
            const students = getStudents();
            const container = document.getElementById('modulePerformance');
            container.innerHTML = '';
            
            modules.forEach(module => {
                let totalProgress = 0;
                let count = 0;
                students.forEach(s => {
                    if (s.progress && s.progress[module.id]) {
                        totalProgress += s.progress[module.id];
                        count++;
                    }
                });
                const avgProgress = count > 0 ? totalProgress / count : 0;
                
                const html = `
                    <div style="margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="font-weight: 600;">${module.icon} ${module.title}</span>
                            <span style="color: #64748b;">${Math.round(avgProgress)}% avg</span>
                        </div>
                        <div class="progress-bar-container">
                            <div class="progress-bar" style="width: ${avgProgress}%"></div>
                        </div>
                    </div>
                `;
                container.innerHTML += html;
            });
        }

        // Student management
        function showAddStudent() {
            document.getElementById('addStudentModal').classList.add('active');
        }

        function handleAddStudent(e) {
            e.preventDefault();
            const students = getStudents();
            
            const username = document.getElementById('studentUsername').value;
            if (students.find(s => s.username === username)) {
                showAlert('addStudentAlert', 'Username already exists', 'error');
                return;
            }
            
            const newStudent = {
                username: username,
                password: document.getElementById('studentPassword').value,
                firstName: document.getElementById('studentFirstName').value,
                lastName: document.getElementById('studentLastName').value,
                email: document.getElementById('studentEmail').value,
                phone: document.getElementById('studentPhone').value,
                notes: document.getElementById('studentNotes').value,
                progress: {},
                createdAt: new Date().toISOString()
            };
            
            students.push(newStudent);
            saveStudents(students);
            
            closeModal();
            loadTeacherDashboard();
            showAlert('loginAlert', `Student ${newStudent.firstName} ${newStudent.lastName} added successfully!`, 'success');
            
            // Reset form
            e.target.reset();
        }

        function viewStudent(index) {
            const students = getStudents();
            const student = students[index];
            alert(`Student Details:\n\nName: ${student.firstName} ${student.lastName}\nUsername: ${student.username}\nEmail: ${student.email || 'Not provided'}\nPhone: ${student.phone || 'Not provided'}\nNotes: ${student.notes || 'None'}`);
        }

        function deleteStudent(index) {
            if (confirm('Are you sure you want to delete this student?')) {
                const students = getStudents();
                students.splice(index, 1);
                saveStudents(students);
                loadTeacherDashboard();
            }
        }

        // Student Dashboard
        function loadStudentDashboard() {
            const fullName = `${currentUser.firstName} ${currentUser.lastName}`;
            document.getElementById('studentName').textContent = fullName;
            document.getElementById('studentAvatar').textContent = currentUser.firstName.charAt(0);
            
            const progress = currentUser.progress || {};
            const totalProgress = Object.values(progress).reduce((a, b) => a + b, 0) / 10;
            const completed = Object.values(progress).filter(p => p === 100).length;
            const questionsCompleted = Object.keys(progress).length * 50;
            
            document.getElementById('studentProgress').textContent = Math.round(totalProgress) + '%';
            document.getElementById('questionsCompleted').textContent = questionsCompleted;
            document.getElementById('studentScore').textContent = '85%'; // Demo
            document.getElementById('modulesCompleted').textContent = `${completed}/10`;
            
            loadStudentModules();
        }

        function loadStudentModules() {
            const container = document.getElementById('studentModules');
            container.innerHTML = '';
            
            modules.forEach(module => {
                const progress = (currentUser.progress && currentUser.progress[module.id]) || 0;
                const card = document.createElement('div');
                card.className = 'module-card';
                card.onclick = () => startModule(module.id);
                
                card.innerHTML = `
                    <div class="module-header">
                        <div class="module-icon">${module.icon}</div>
                        <div class="module-info">
                            <div class="module-title">${module.title}</div>
                            <div class="module-desc">${module.desc}</div>
                        </div>
                    </div>
                    <div class="module-body">
                        <div class="progress-bar-container" style="margin-bottom: 12px;">
                            <div class="progress-bar" style="width: ${progress}%"></div>
                        </div>
                        <div class="module-stats">
                            <span>${progress}% Complete</span>
                            <span>${module.questions} Questions</span>
                        </div>
                        <button class="btn btn-primary btn-block">
                            ${progress === 0 ? '‚ñ∂Ô∏è Start Learning' : progress === 100 ? '‚úì Review' : '‚ñ∂Ô∏è Continue'}
                        </button>
                    </div>
                `;
                
                container.appendChild(card);
            });
        }

        function startModule(moduleId) {
            // Open the quiz (link to your quiz file)
            window.open('index.html', '_blank');
            
            // Update progress (demo)
            if (!currentUser.progress) currentUser.progress = {};
            currentUser.progress[moduleId] = Math.min(100, (currentUser.progress[moduleId] || 0) + 20);
            
            // Save to storage
            const students = getStudents();
            const index = students.findIndex(s => s.username === currentUser.username);
            if (index !== -1) {
                students[index] = currentUser;
                saveStudents(students);
            }
            saveToStorage();
            
            setTimeout(() => {
                loadStudentDashboard();
            }, 500);
        }

        // Utility functions
        function closeModal() {
            document.querySelectorAll('.modal').forEach(m => m.classList.remove('active'));
        }

        function showAlert(elementId, message, type) {
            const el = document.getElementById(elementId);
            el.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
            setTimeout(() => { el.innerHTML = ''; }, 5000);
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                currentUser = null;
                clearStorage();
                document.querySelectorAll('.dashboard').forEach(d => d.classList.remove('active'));
                document.getElementById('loginScreen').style.display = 'flex';
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
            }
        }

        // Initialize
        window.onload = init;
    </script>
</body>
</html>
